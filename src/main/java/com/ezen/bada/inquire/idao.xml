<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.ezen.bada.inquire.Service">
	
<select id="input_info" resultType="com.ezen.bada.member.MemberDTO">
	select id, name from bada_user where id=#{param1}
</select>

<insert id="inquire_save">
	insert into bada_inquire (inquire_num, title, category, name, id, pic1, pic2, pic3, pic4, pic5, content, secret, secret_pw) 
	values (inquire_seq.nextval, #{param1}, #{param2}, #{param3}, #{param4}, #{param5}, #{param6}, #{param7}, #{param8}, 
	 #{param9}, #{param10}, #{param11}, #{param12})
</insert>

<!-- 페이징처리에서 전체레코드수 구하기 -->


<select id="inquire_list_total" resultType="int">
	select count(*)from bada_inquire
</select>

<!-- 한 페이지 안에 들어갈 만큼의 리스트 목록을 잘라오기 -->


<select id="page_inquire_listout" resultType="com.ezen.bada.inquire.InquireDTO">
	select * from( select rownum rn, A.* from(
		select inquire_num, title, category, name, id, i_date, 
		pic1, pic2, pic3, pic4, pic5, content, secret, secret_pw, reply, rec, cnt 
		from bada_inquire
		order by inquire_num DESC) A) 
	where rn between #{start} AND #{end}
</select>


<select id="inquire_list_total_search" resultType="int">
	select count(*) from bada_inquire 
		<if test="#{param1} == null and #{param3} == null and #{param4} != null">
	  		where i_date like '%' || #{param4} || '%'
		</if>
		<if test="#{param1} == null and #{param3} != null and #{param4} == null">
	  		where category like '%' || #{param3} || '%'
		</if>
		<if test="#{param1} == null and #{param3} != null and #{param4} != null">
	  		where category like '%' || #{param3} || '%' and i_date like '%' || #{param4} || '%'
		</if>
		
		<if test="#{param1} != null and #{param1} eq 'name' and #{param3} == null and #{param4} != null">
		where name like '%' || #{param4} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'name' and #{param3} != null and #{param4} == null">
		where name like '%' || #{param4} || '%' and category like '%' || #{param3} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'name' and #{param3} != null and #{param4} != null">
		where name like '%' || #{param4} || '%' and 
		category like '%' || #{param3} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'name' and #{param3} == null and #{param4} != null">
		where name like '%' || #{param4} || '%'
	  		</if>
	  		
	  		<if test="#{param1} != null and #{param1} eq 'title' and #{param3} == null and #{param4} != null">
		where title like '%' || #{param4} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'title' and #{param3} != null and #{param4} == null">
		where title like '%' || #{param4} || '%' and category like '%' || #{param3} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'title' and #{param3} != null and #{param4} != null">
		where title like '%' || #{param4} || '%' and 
		category like '%' || #{param3} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'title' and #{param3} == null and #{param4} != null">
		where title like '%' || #{param4} || '%'
	  		</if>
	  		
	  		<if test="#{param1} != null and #{param1} eq 'content' and #{param3} == null and #{param4} != null">
		where content like '%' || #{param4} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'content' and #{param3} != null and #{param4} == null">
		where content like '%' || #{param4} || '%' and category like '%' || #{param3} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'content' and #{param3} != null and #{param4} != null">
		where content like '%' || #{param4} || '%' and 
		category like '%' || #{param3} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'content' and #{param3} == null and #{param4} != null">
		where content like '%' || #{param4} || '%'
	  		</if>
</select>


<select id="page_inquire_listout_search" resultType="com.ezen.bada.inquire.InquireDTO">
   select * from 
	   (  select rownum rn, A.* from
	   		(  select inquire_num, title, category, name, id, i_date,
	   		pic1, pic2, pic3, pic4, pic5, content, secret, secret_pw, reply, rec, cnt 
	   		from bada_inquire 
	   		
	   		<if test="#{param1} == null and #{param3} == null and #{param4} != null">
	  		where i_date like '%' || #{param4} || '%'
		</if>
		<if test="#{param1} == null and #{param3} != null and #{param4} == null">
	  		where category like '%' || #{param3} || '%'
		</if>
		<if test="#{param1} == null and #{param3} != null and #{param4} != null">
	  		where category like '%' || #{param3} || '%' and i_date like '%' || #{param4} || '%'
		</if>
		
		<if test="#{param1} != null and #{param1} eq 'name' and #{param3} == null and #{param4} != null">
		where name like '%' || #{param4} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'name' and #{param3} != null and #{param4} == null">
		where name like '%' || #{param4} || '%' and category like '%' || #{param3} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'name' and #{param3} != null and #{param4} != null">
		where name like '%' || #{param4} || '%' and 
		category like '%' || #{param3} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'name' and #{param3} == null and #{param4} != null">
		where name like '%' || #{param4} || '%'
	  		</if>
	  		
	  		<if test="#{param1} != null and #{param1} eq 'title' and #{param3} == null and #{param4} != null">
		where title like '%' || #{param4} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'title' and #{param3} != null and #{param4} == null">
		where title like '%' || #{param4} || '%' and category like '%' || #{param3} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'title' and #{param3} != null and #{param4} != null">
		where title like '%' || #{param4} || '%' and 
		category like '%' || #{param3} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'title' and #{param3} == null and #{param4} != null">
		where title like '%' || #{param4} || '%'
	  		</if>
	  		
	  		<if test="#{param1} != null and #{param1} eq 'content' and #{param3} == null and #{param4} != null">
		where content like '%' || #{param4} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'content' and #{param3} != null and #{param4} == null">
		where content like '%' || #{param4} || '%' and category like '%' || #{param3} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'content' and #{param3} != null and #{param4} != null">
		where content like '%' || #{param4} || '%' and 
		category like '%' || #{param3} || '%' and i_date like '%' || #{param4} || '%'
	  		</if>
	  		<if test="#{param1} != null and #{param1} eq 'content' and #{param3} == null and #{param4} != null">
		where content like '%' || #{param4} || '%'
	  		</if>
	   		
	   		order by inquire_num DESC) A 
	   			 )
	   where rn between #{param5} AND #{param6}
</select>

<select resultType="com.ezen.bada.inquire.InquireDTO" id="inquire_detail">
	select * from bada_inquire where inquire_num=#{param1}
</select>
	
</mapper>